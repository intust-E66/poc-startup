<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Dashboard ‚Äî POCKit</title>
    <meta name="description" content="‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏° real-time ‚Äî ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mentor">
    <link rel="stylesheet" href="/style.css">
    <style>
        .dashboard-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }

        .team-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: all var(--transition-base);
        }

        .team-card:hover {
            border-color: var(--border-gold);
        }

        .team-card__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .team-card__name {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .team-card__status {
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status--pending {
            background: rgba(255, 255, 255, 0.06);
            color: var(--text-muted);
        }

        .status--working {
            background: rgba(249, 115, 22, 0.15);
            color: var(--orange);
        }

        .status--done {
            background: rgba(16, 185, 129, 0.15);
            color: var(--green);
        }

        .team-card__field {
            margin-bottom: 12px;
        }

        .team-card__label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
        }

        .team-card__value {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .team-card__check {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .add-team-card {
            background: var(--bg-secondary);
            border: 2px dashed var(--border);
            border-radius: var(--radius-lg);
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 200px;
        }

        .add-team-card:hover {
            border-color: var(--gold);
            background: rgba(240, 185, 11, 0.03);
        }

        .stats-row {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
        }

        .stat-card__number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gold);
            font-variant-numeric: tabular-nums;
        }

        .stat-card__label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
    </style>
</head>

<body>
    <main class="main" id="dashboardContent" style="display:none;">
        <section class="section container">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                <div class="hero__badge">üìä Team Dashboard</div>
                <button class="btn btn--outline" id="logoutBtn"
                    style="padding:6px 16px;font-size:0.8rem;">Logout</button>
            </div>
            <h1 style="font-size:2rem;font-weight:900;margin-bottom:8px;">Team Dashboard</h1>
            <div
                style="display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:12px;">
                <p style="color:var(--text-secondary);margin:0;">‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏° ‚Äî ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mentor ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏ó‡∏µ‡∏°
                </p>
                <button class="btn" id="resetDataBtn"
                    style="background:rgba(239, 68, 68, 0.1);color:var(--red);border:1px solid rgba(239, 68, 68, 0.3);padding:8px 16px;font-size:0.85rem;">‚ö†Ô∏è
                    Reset Data ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>

            <!-- Stats Overview -->
            <div class="stats-row" id="statsRow">
                <div class="stat-card">
                    <div class="stat-card__number" id="totalTeams">0</div>
                    <div class="stat-card__label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card__number" id="psComplete">0</div>
                    <div class="stat-card__label">Problem Statement ‚úÖ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card__number" id="protoStatus">0</div>
                    <div class="stat-card__label">‡∏°‡∏µ Prototype ‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card__number" id="testDone">0</div>
                    <div class="stat-card__label">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
            </div>

            <!-- Team Cards -->
            <div class="dashboard-grid" id="dashboardGrid">
                <div class="add-team-card" id="addTeamBtn">
                    <div style="font-size:2.5rem;margin-bottom:8px;">‚ûï</div>
                    <div style="font-weight:600;color:var(--text-secondary);">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add/Edit Team Modal -->
    <div class="modal-overlay" id="teamModal"
        style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:2000;opacity:0;pointer-events:none;transition:opacity 0.3s;">
        <div
            style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-xl);padding:32px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;">
            <h3 style="margin-bottom:20px;font-weight:700;" id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</h3>
            <div class="form-group">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label>
                <input type="text" class="form-input" id="mTeamName">
            </div>
            <div class="form-group">
                <label class="form-label">Problem Statement</label>
                <textarea class="form-textarea" id="mProblem"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Core Solution</label>
                <textarea class="form-textarea" id="mSolution" style="min-height:60px;"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</label>
                <select class="form-select" id="mTechnique">
                    <option value="">‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option>
                    <option value="wizard">üé© Wizard of Oz</option>
                    <option value="concierge">ü§ù Concierge</option>
                    <option value="fakedoor">üö™ Fake Door</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Prototype</label>
                <select class="form-select" id="mStatus">
                    <option value="pending">‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</option>
                    <option value="working">üî® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</option>
                    <option value="done">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Mentor Notes</label>
                <textarea class="form-textarea" id="mNotes" placeholder="‡∏à‡∏î‡πÇ‡∏ô‡πâ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß..."></textarea>
            </div>
            <div style="display:flex;gap:12px;">
                <button class="btn btn--primary" style="flex:1;" id="saveTeamBtn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button class="btn btn--secondary" id="cancelTeamBtn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal"
        style="position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg-primary);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div
            style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-xl);padding:40px;width:100%;max-width:400px;text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">üîê</div>
            <h2 style="margin-bottom:8px;">Dashboard Login</h2>
            <p style="color:var(--text-secondary);margin-bottom:24px;font-size:0.9rem;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°
            </p>

            <div class="form-group" style="text-align:left;">
                <label class="form-label">Username</label>
                <input type="text" class="form-input" id="loginUser" placeholder="Enter username">
            </div>
            <div class="form-group" style="text-align:left;">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="loginPass" placeholder="Enter password">
            </div>

            <div id="loginError" style="color:var(--red);font-size:0.85rem;margin-bottom:16px;display:none;">‚ùå Username
                ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>

            <button class="btn btn--primary" style="width:100%;padding:14px;" id="loginSubmitBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <script type="module">
        import { createNav, createFooter } from '/js/components.js';
        createNav('dashboard');
        createFooter();

        let teams = JSON.parse(localStorage.getItem('pockit_teams') || '[]');
        let editIdx = -1;

        // Login Logic
        const IS_LOGGED_IN = sessionStorage.getItem('dashboard_auth') === 'true';
        if (IS_LOGGED_IN) {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'block';
        }

        document.getElementById('loginSubmitBtn').addEventListener('click', () => {
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;
            
            if (u === 'intust' && p === 'aitest66') {
                sessionStorage.setItem('dashboard_auth', 'true');
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('dashboard_auth');
            location.reload();
        });

        document.getElementById('resetDataBtn').addEventListener('click', () => {
            if (confirm('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°?\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ)')) {
                const confirmText = prompt('‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "RESET" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:');
                if (confirmText === 'RESET') {
                    localStorage.removeItem('pockit_teams');
                    teams = [];
                    renderTeams();
                    alert('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
        });

        function saveTeams() {
            localStorage.setItem('pockit_teams', JSON.stringify(teams));
        }

        function renderTeams() {
            const grid = document.getElementById('dashboardGrid');
            const addBtn = document.getElementById('addTeamBtn');

            // Remove existing team cards
            grid.querySelectorAll('.team-card').forEach(c => c.remove());

            teams.forEach((team, i) => {
                const statusClass = team.status === 'done' ? 'status--done' : team.status === 'working' ? 'status--working' : 'status--pending';
                const statusLabel = team.status === 'done' ? '‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à' : team.status === 'working' ? 'üî® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' : '‚è≥ ‡∏£‡∏≠';
                const techniqueLabel = team.technique === 'wizard' ? 'üé© Wizard of Oz' : team.technique === 'concierge' ? 'ü§ù Concierge' : team.technique === 'fakedoor' ? 'üö™ Fake Door' : '‚Äî';

                const card = document.createElement('div');
                card.className = 'team-card';
                card.innerHTML = `
          <div class="team-card__header">
            <div class="team-card__name">${team.name || '‡∏ó‡∏µ‡∏° ' + (i + 1)}</div>
            <span class="team-card__status ${statusClass}">${statusLabel}</span>
          </div>
          <div class="team-card__field">
            <div class="team-card__label">Problem Statement</div>
            <div class="team-card__value">${team.problem || '‚Äî'}</div>
          </div>
          <div class="team-card__field">
            <div class="team-card__label">Core Solution</div>
            <div class="team-card__value">${team.solution || '‚Äî'}</div>
          </div>
          <div class="team-card__field">
            <div class="team-card__label">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</div>
            <div class="team-card__value">${techniqueLabel}</div>
          </div>
          ${team.risk ? `<div class="team-card__field"><div class="team-card__label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å</div><div class="team-card__value" style="font-size:0.85rem;color:var(--text-muted);">${team.risk}</div></div>` : ''}
          ${team.notes ? `<div class="team-card__field"><div class="team-card__label">Notes</div><div class="team-card__value">${team.notes}</div></div>` : ''}
          <div style="display:flex;gap:8px;margin-top:16px;">
            <button class="btn btn--outline" style="flex:1;padding:8px;" data-edit="${i}">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="btn btn--secondary" style="padding:8px;" data-delete="${i}">üóëÔ∏è</button>
          </div>
        `;
                grid.insertBefore(card, addBtn);
            });

            // Update stats
            document.getElementById('totalTeams').textContent = teams.length;
            document.getElementById('psComplete').textContent = teams.filter(t => t.problem).length;
            document.getElementById('protoStatus').textContent = teams.filter(t => t.status === 'done').length;
            document.getElementById('testDone').textContent = teams.filter(t => t.technique).length;

            // Attach event listeners
            grid.querySelectorAll('[data-edit]').forEach(btn => {
                btn.addEventListener('click', () => openEditModal(parseInt(btn.dataset.edit)));
            });
            grid.querySelectorAll('[data-delete]').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ?')) {
                        teams.splice(parseInt(btn.dataset.delete), 1);
                        saveTeams();
                        renderTeams();
                    }
                });
            });
        }

        function openModal() {
            document.getElementById('teamModal').style.opacity = '1';
            document.getElementById('teamModal').style.pointerEvents = 'auto';
        }

        function closeModal() {
            document.getElementById('teamModal').style.opacity = '0';
            document.getElementById('teamModal').style.pointerEvents = 'none';
        }

        function openEditModal(idx) {
            editIdx = idx;
            const team = teams[idx];
            document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ' + team.name;
            document.getElementById('mTeamName').value = team.name || '';
            document.getElementById('mProblem').value = team.problem || '';
            document.getElementById('mSolution').value = team.solution || '';
            document.getElementById('mTechnique').value = team.technique || '';
            document.getElementById('mStatus').value = team.status || 'pending';
            document.getElementById('mNotes').value = team.notes || '';
            openModal();
        }

        document.getElementById('addTeamBtn').addEventListener('click', () => {
            editIdx = -1;
            document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°';
            document.getElementById('mTeamName').value = '';
            document.getElementById('mProblem').value = '';
            document.getElementById('mSolution').value = '';
            document.getElementById('mTechnique').value = '';
            document.getElementById('mStatus').value = 'pending';
            document.getElementById('mNotes').value = '';
            openModal();
        });

        document.getElementById('saveTeamBtn').addEventListener('click', () => {
            const data = {
                name: document.getElementById('mTeamName').value,
                problem: document.getElementById('mProblem').value,
                solution: document.getElementById('mSolution').value,
                technique: document.getElementById('mTechnique').value,
                status: document.getElementById('mStatus').value,
                notes: document.getElementById('mNotes').value,
            };
            if (editIdx >= 0) {
                teams[editIdx] = data;
            } else {
                teams.push(data);
            }
            saveTeams();
            renderTeams();
            closeModal();
        });

        document.getElementById('cancelTeamBtn').addEventListener('click', closeModal);
        document.getElementById('teamModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeModal();
        });

        // Auto-refresh data every 5 seconds to catch new submissions
        setInterval(() => {
            if (sessionStorage.getItem('dashboard_auth') === 'true') {
                const newTeams = JSON.parse(localStorage.getItem('pockit_teams') || '[]');
                // Simple equality check by stringify to avoid re-rendering if no changes
                if (JSON.stringify(newTeams) !== JSON.stringify(teams)) {
                    teams = newTeams;
                    renderTeams();
                }
            }
        }, 5000);

        renderTeams();
    </script>
</body>

</html>